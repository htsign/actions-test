name: CI

on: [push, pull_request]

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
      - name: debug
        uses: actions/github-script@v1
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const fs = require('fs');
            const { promisify } = require('util');

            const files = await promisify(fs.readdir)('.');
            console.log(files);

            const { commits, pull_request, head_commit, compare } = context.payload;
            console.log({ context, head_commit });

            switch (context.eventName) {
              case 'push':
                console.log(commits);
                break;
              case 'pull_request':
                console.log(pull_request);
                break;
            }

            const [, base, head] = compare.match(/\/compare\/([0-9a-f]+)\.\.\.([0-9a-f]+)$/);
            if (base && head) {
              const { owner, repo } = context.repo;
              const { data } = await github.repos.compareCommits({ owner, repo, base, head });
              const files = data.files.map(file => file.filename);
              console.log(files);
            }
